{section}
{column:width=3%}
{column}
{column}
\\
{panel:borderColor=#f7681a|borderWidth=2}
{center}
\\
h3. {color:#f7681a}この記事では検索とデータバッグの基本を紹介しています。{color}

h5. {color:#f7681a}Chef の非常に強力な機能であり、データに基づいてインフラの設定を動的に変更することができます。{color}
{center}
\\
{panel}

h1. 検索
!SEARCH-1-1.png|align=left,thumbnail,hspace=8,vspace=6!

検索は Chef サーバの機能であり、(Apache Solr ベースの) 検索エンジンを利用してインフラやアプリケーションに関する情報を問い合わせることができます。ノードの属性やデータバッグ (下記参照)、環境、ロール、API クライアントに含まれる情報はすべて検索が可能です。

{color:#f7681a}レシピの中で検索したり、Chef ワークステーションで knife を使って検索したりすることができます。{color}たとえばレシピの中でアプリケーションサーバの一覧を取得し、ロードバランサの設定に追加したいことがあるでしょう。これをやるには、"appserver" というロールを使っているノードのすべてを検索すると思います：

{code}
app_servers = search(:node, 'role:appserver')
{code}

*検索結果は静的ではないものになるでしょう。* むしろ、chef-client が起動するたびに、結果はその時点でインフラに存在するすべてのアプリサーバを反映すると思います。 _こういう仕組みのおかげでインフラをスケールさせることができ、ロードバランサのような既存の構成要素とうまく連携できます。_

また他のやり方として、ワークステーションでも素早くアプリケーションサーバの役割を持つノードを一覧することができます：

{code}
knife search node 'role:appserver'
{code}

検索についての詳しい情報は[検索]を参照してください。

h1. データバッグ

!big_data_nerd_bag-p1496631464820063122wl62_125.png|align=right,hspace=8,vspace=6!

{color:#f7681a}データバッグは Chef サーバに (属性と同じような) ネストしたキーバリューのデータを保存します。{color} データバッグ内のデータは検索可能であり、レシピから直接名前を指定してロードすることも可能です。データバッグは Chef サーバがインストールされている環境ではどこからでもアクセスできますーーインフラ全体の属性と考えてもよいでしょう。

たとえば、あるノードでたくさんのユーザアカウントが必要だとします。ユーザ毎に新しいリソースを書かずに、ユーザの情報をすべてデータバッグに保存し、レシピをシンプルにすることができます：

{code}
search(:users, '*:*') do |u|
  user u["username"] do
    home u["home"]
    shell u["shell"]
    comment u["comment"]
  end
end
{code}

こうしておけば、ノードに新しいユーザを追加したいときでも、レシピを編集せず、データバッグを編集すればよくなります。 _レシピがシンプルになるだけでなく、検索すればいつでもインフラに関する重要なデータが利用できるのです。_ このようにデータが検索できるということは、インフラに関して知りたいことが出てきたときでも knife を使えば素早く回答できるということです。たとえば "hank" というユーザが使っているデフォルトのシェルを知りたかったら、knife で下記のコマンドを打てばよいです：

{code}
knife search users 'username:hank' -a shell
{code}

{color:#f7681a}繊細なデータを含むデータバッグならば、Chef の *暗号化データバッグ* を使って安全に暗号化された内容を Chef サーバに保存することもできます。{color}  データバッグと暗号化データバッグについての詳細は[データバッグ]と[暗号化データバッグ]をご参照ください。


h1. まとめ

* 検索によってレシピや knife からインフラに関する情報を問い合わせることができる。
* データバッグにデータを保存し検索することができる。データは検索可能となり、レシピで利用することができる。

h1. レッツゴー

Chef の基本的な概念について読了したので、はじめてのクックブックを書くためのガイドとして[クックブックを作りレシピを書くためのガイド]をチェックしてみてはどうでしょうか。手っ取り早く Chef ワークステーションとノードを設定して Chef ホスティングの Chef サーバを利用してみたいなら [すぐに始めるためのガイド] がオススメです。

h1. もっとよく知りたいなら

* [検索]
* [データバッグ]
* [暗号化データバッグ]

\\
\\
\\
\\
{column}
{column:width=5%}
{column}
{section}
{section}
----
{column:width=45%}

!leftarrow.png|align=left,hspace=4! 
[クックブックその他いろいろの紹介]

{column}
{column:width=40%}
{column}

{column:width=15%}

!rightarrow.png|align=right,hspace=4! 
[アーキテクチャ]

\\
\\
{column}
{section}
